<html>
	<head>
		<script type="text/javascript" src="chrome_ex_oauth.js"></script>
		<script type="text/javascript" src="chrome_ex_oauthsimple.js"></script>
		<script type="text/javascript">
var CONSUMER_KEY = "Yocs3IGzpE1wOLmj6cIAhQ";
var CONSUMER_SECRET = "66Ty5h2YQ2EHH1WkuWMprR6S2ZvHXoMAX8cbejBHU";
	
var OAUTH_TOKEN = "";
var OAUTH_TOKEN_SECRET = "";
	
var xhr = new XMLHttpRequest();
xhr.inreadystatechange = function(data) {
	if (xhr.readyState == 4) {
            if (xhr.status == 200) {
              var data = xhr.responseText;
              var parameters = data.split("&");
			  for( var i=0; i < parameters.length; i++) {
				var param = parameters[i].split("=");
				if(param[0] == "oauth_token") {
					OAUTH_TOKEN = param[1];
				} else if (param[0] == "oauth_token_secret") {
					OAUTH_TOKEN_SECRET = param[1];
				}
			  }
            } else {
              callback(null);
            }
			chrome.tabs.create({"url": "https://www.yammer.com/oauth/authorize?oauth_token=" + OAUTH_TOKEN});
          }
}
var url = 'https://www.yammer.com/oauth/request_token';
xhr.setRequestHeader('Authorization', oauth_headers(null, null, null))
xhr.open('POST', url, true);
xhr.send();

  function oauth_headers(String token, String token_secret, String verifier) {
	var buff = []
    buff.append("OAuth realm=\"");
    buff.append("\", oauth_consumer_key=\"");
    buff.append(CONSUMER_KEY);
    buff.append("\", ");

    if (token != null) {
      buff.append("oauth_token=\"");
      buff.append(token);
      buff.append("\", ");
    }
    
    buff.append("oauth_signature_method=\"");
    buff.append("PLAINTEXT");
    buff.append("\", oauth_signature=\"");
    buff.append(CONSUMER_SECRET);
    buff.append("%26");
    if (token_secret != null) {
      buff.append(token_secret);
    }
	
	var date = new Date();
	
    buff.append("\", oauth_timestamp=\"");
    buff.append(date);
    buff.append("\", oauth_nonce=\"");
    buff.append(date);

    if (verifier != null) {
      buff.append("\", ");
      buff.append("oauth_verifier=\"");
      buff.append(verifier);
    }

    buff.append("\", oauth_version=\"1.0\"");

    return buff.join("");
  }


	
var oauth = ChromeExOAuth.initBackgroundPage({
  'request_url': "https://www.yammer.com/oauth/request_token",
  'authorize_url': "https://www.yammer.com/oauth/access_token",
  'access_url': "https://www.yammer.com/oauth/access_token",
  'consumer_key': "Yocs3IGzpE1wOLmj6cIAhQ",
  'consumer_secret': "66Ty5h2YQ2EHH1WkuWMprR6S2ZvHXoMAX8cbejBHU",
  'app_name': "Enterprise"
});

var currentYams = []

function messageHandler(resp, xhr) {
	var currentYams = JSON.parse(resp);
}

function onAuthorized() {
	var url = "https://www.yammer.com/api/v1/messages.json";
	var request = {"method": "GET"};
	
	oauth.sendSignedRequest(url, messageHandler, request);
}

//oauth.authorize(onAuthorized);

function fetchYams(callback) {
	callback(currentYams);
}
		</script>
	</head>
	<body>
	</body>
</html>